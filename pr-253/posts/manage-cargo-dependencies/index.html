<!DOCTYPE html>
<html lang="ja">
<head>
  
    <title>cargoプロジェクトで依存関係を継続的に管理する :: blog.kyu08.com</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="OSSに依存するプロジェクトでは依存しているライブラリのライセンス表記が必要になることがある。（体感的にはほとんどのライブラリはライセンス表" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.kyu08.com/pr-253/posts/manage-cargo-dependencies/" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-BDQ408J45J"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BDQ408J45J', { 'anonymize_ip': false });
}
</script>




  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/main.min.0832e53463742bab51a209f71625f505d20a9662c72e6fc66248658a02e0f4b9.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/menu.min.48f42ef526b5c0c074cc696ab2e25a4316fdb58c4f42be6ee88c83fed3fe3c90.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/post.min.d551b54605ea87772c5eb05bf68219699a011687df301682a1006e8811253df9.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/terminal.min.08e270ae3e1713b186bb6da1e872f4ed403127d18ae635cf9c981c6633809797.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/pr-253/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">




<link rel="stylesheet" href="https://blog.kyu08.com/pr-253/style.css">


<link rel="shortcut icon" href="https://blog.kyu08.com/pr-253/favicon.png">
<link rel="apple-touch-icon" href="https://blog.kyu08.com/pr-253/apple-touch-icon.png">


<meta name="twitter:card" content="summary_large_image" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="kyu08_" />



<meta property="og:locale" content="ja" />
<meta property="og:type" content="article" />
<meta property="og:title" content="cargoプロジェクトで依存関係を継続的に管理する">
<meta property="og:description" content="OSSに依存するプロジェクトでは依存しているライブラリのライセンス表記が必要になることがある。（体感的にはほとんどのライブラリはライセンス表" />
<meta property="og:url" content="https://blog.kyu08.com/pr-253/posts/manage-cargo-dependencies/" />
<meta property="og:site_name" content="blog.kyu08.com" />


  
  
    
  


  <meta property="og:image" content="https://blog.kyu08.com/pr-253/posts/manage-cargo-dependencies/cover.png">
  <meta name="twitter:image" content="https://blog.kyu08.com/pr-253/posts/manage-cargo-dependencies/cover.png">
  <meta name="twitter:image:alt" content="cargoプロジェクトで依存関係を継続的に管理する">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">


  <meta property="article:published_time" content="2025-05-20 15:00:00 &#43;0000 UTC" />









<link rel="author" href="http://www.hatena.ne.jp/kyu08/" />




<script async src="https://www.googletagmanager.com/gtag/js?id=G-BDQ408J45J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{ . }}');
</script>




</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    blog.kyu08.com
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/pr-253/tags/diary/">_misc</a></li>
        
      
        
          <li><a href="/pr-253/about">about</a></li>
        
      
        
          <li><a href="/pr-253/index.xml">rss</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/pr-253/tags/diary/" >_misc</a></li>
        
      
        
          <li><a href="/pr-253/about" >about</a></li>
        
      
        
          <li><a href="/pr-253/index.xml" >rss</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.kyu08.com/pr-253/posts/manage-cargo-dependencies/">cargoプロジェクトで依存関係を継続的に管理する</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025/05/20</time>
      
    <span class="post-reading-time">7 min read (3052 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.kyu08.com/pr-253/tags/cargo/">cargo</a>&nbsp;
      
      #<a href="https://blog.kyu08.com/pr-253/tags/rust/">rust</a>&nbsp;
      
      #<a href="https://blog.kyu08.com/pr-253/tags/oss/">OSS</a>&nbsp;
      
    </span>
  
  
  <img src="/pr-253/posts/manage-cargo-dependencies/cover.png"
    class="post-cover"
    alt="cargoプロジェクトで依存関係を継続的に管理する"
    title="Cover Image" />


  
    <div class="table-of-contents">
      <h2>
        目次
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#tldr">tl;dr</a></li>
    <li><a href="#cargo-macheteで不要な依存関係を検出する"><code>cargo-machete</code>で不要な依存関係を検出する</a>
      <ul>
        <li><a href="#why">why</a></li>
        <li><a href="#what">what</a></li>
        <li><a href="#howローカル">how(ローカル)</a></li>
        <li><a href="#howci">how(CI)</a></li>
      </ul>
    </li>
    <li><a href="#cargo-denyで依存ライブラリに許容しないライセンスが含まれていないか検証する"><code>cargo-deny</code>で依存ライブラリに許容しないライセンスが含まれていないか検証する</a>
      <ul>
        <li><a href="#why-1">why</a></li>
        <li><a href="#what-1">what</a></li>
        <li><a href="#howローカル-1">how(ローカル)</a></li>
        <li><a href="#howci-1">how(CI)</a></li>
      </ul>
    </li>
    <li><a href="#cargo-aboutでリポジトリのライセンス表記が最新か検証する"><code>cargo-about</code>でリポジトリのライセンス表記が最新か検証する</a>
      <ul>
        <li><a href="#why-2">why</a></li>
        <li><a href="#what-2">what</a></li>
        <li><a href="#howローカル-2">how(ローカル)</a></li>
        <li><a href="#howci-2">how(CI)</a></li>
      </ul>
    </li>
    <li><a href="#おわりに">おわりに</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <p>OSSに依存するプロジェクトでは依存しているライブラリのライセンス表記が必要になることがある。（体感的にはほとんどのライブラリはライセンス表記を求めているように思う）</p>
<p>そのため、依存ライブラリが増えた場合にはライセンス表記を更新する必要があるが、依存ライブラリの依存ライブラリに対しても再帰的にライセンス表記を見に行って自リポジトリの依存ライセンス表記ファイルを更新して&hellip;という作業を行うのは現実的ではない。</p>
<p>他にもうっかりコピーレフトなライブラリに依存してしまうとプロジェクトのライセンスを変更しなければならなかったりと案外注意すべきポイントが多い。</p>
<p>cargoプロジェクトにおいてこれらの労力を削減してくれるツールがいくつか存在している。</p>
<p>筆者は趣味プロジェクトとして<code>fzf-make</code>というmake targetやpnpm script, yarn script, just recipeをfuzzy finder形式で選択、実行できるCLIツール<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>をRustで開発しており、このプロジェクトで最近それらのツールを導入したので使い方とともに紹介する。</p>
<h2 id="tldr">tl;dr<a href="#tldr" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>以下のチェックをCIで実行することでcargoプロジェクトの依存関係を継続的に省力で管理できる。</p>
<ul>
<li><a href="https://github.com/bnjbvr/cargo-machete" target="_blank" ><code>cargo-machete</code></a>: 不要な依存関係がないか</li>
<li><a href="https://github.com/EmbarkStudios/cargo-deny" target="_blank" ><code>cargo-deny</code></a>: 依存ライブラリに許容しないライセンスが含まれていないか</li>
<li><a href="https://github.com/EmbarkStudios/cargo-about" target="_blank" ><code>cargo-about</code></a>: リポジトリのライセンス表記ファイルに更新漏れがないか</li>
</ul>
<p>それぞれ紹介する。なお、コード例はそれぞれ以下のランナーを想定している。</p>
<table>
<thead>
<tr>
<th>環境</th>
<th>ランナー</th>
</tr>
</thead>
<tbody>
<tr>
<td>ローカル</td>
<td>make</td>
</tr>
<tr>
<td>CI</td>
<td>GitHub Actions</td>
</tr>
</tbody>
</table>
<h2 id="cargo-macheteで不要な依存関係を検出する"><code>cargo-machete</code>で不要な依存関係を検出する<a href="#cargo-macheteで不要な依存関係を検出する" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="why">why<a href="#why" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>ある程度の期間開発を続けていると以前追加した依存関係が不要になったことに気付かずに<code>cargo.toml</code>の<code>dependencies</code>や<code>dev-dependencies</code>に残ったままになることがある。
不要な依存関係が残ったままになっているとrenovateやdependabotによるバージョン更新の手間が不必要に増えてしまうのでPRの時点で気付けるようにしたい。</p>
<h3 id="what">what<a href="#what" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><a href="https://github.com/bnjbvr/cargo-machete" target="_blank" >cargo-machete</a>を使って<code>cargo.toml</code>に記述されている依存関係のうち、プロジェクトが実際には依存していない依存関係を検出する。</p>
<h3 id="howローカル">how(ローカル)<a href="#howローカル" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなmake targetを定義しておくと<code>make detect-unused-dependencies</code>で不要な依存関係を検出できる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> tool-detect-unused-dependencies
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tool-detect-unused-dependencies</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@if ! which cargo-machete &gt; /dev/null; <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		cargo install --locked cargo-machete; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> detect-unused-dependencies
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">detect-unused-dependencies</span><span style="color:#f92672">:</span> tool-detect-unused-dependencies
</span></span><span style="display:flex;"><span>	cargo machete
</span></span></code></pre></div><p>以下は不必要な依存関係として<code>tempfile</code>が検出されている様子。</p>
<p><img src="cargo-machete.webp" alt="cargo-machete"></p>
<h3 id="howci">how(CI)<a href="#howci" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなyamlを定義しておくと不要な依存関係がある場合にCIが落ちてくれる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Detect unused dependencies</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">detect-unused-dependencies</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Machete</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">bnjbvr/cargo-machete@v0.8.0</span>
</span></span></code></pre></div><h2 id="cargo-denyで依存ライブラリに許容しないライセンスが含まれていないか検証する"><code>cargo-deny</code>で依存ライブラリに許容しないライセンスが含まれていないか検証する<a href="#cargo-denyで依存ライブラリに許容しないライセンスが含まれていないか検証する" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="why-1">why<a href="#why-1" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>筆者は<code>fzf-make</code>をより自由に利用してほしいと考えているためMITライセンスでプロジェクトを公開したい。
コピーレフトのライセンスに依存してしまうとライセンス変更を余儀なくされるため、コピーレフトのライブラリに依存することを避けたい。</p>
<h3 id="what-1">what<a href="#what-1" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><a href="https://github.com/EmbarkStudios/cargo-deny" target="_blank" >cargo-deny</a>は依存関係のlint機能を提供する。<code>fzf-make</code>では、<code>cargo deny check licenses</code>を用いてホワイトリストに登録したライセンス以外のライセンスが依存ライブラリに含まれていないか検証している。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#75715e"># deny.toml</span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">licenses</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">allow</span> = [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;MIT&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ISC&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Apache-2.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;MPL-2.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;BSD-2-Clause&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;BSD-3-Clause&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Unicode-DFS-2016&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;OpenSSL&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">confidence-threshold</span> = <span style="color:#ae81ff">0.8</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exceptions</span> = []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#a6e22e">licenses</span>.<span style="color:#a6e22e">clarify</span>]]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;ring&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expression</span> = <span style="color:#e6db74">&#34;MIT AND ISC AND OpenSSL&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">license-files</span> = [
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">path</span> = <span style="color:#e6db74">&#34;LICENSE&#34;</span>, <span style="color:#a6e22e">hash</span> = <span style="color:#ae81ff">0</span><span style="color:#a6e22e">xbd0eed23</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="howローカル-1">how(ローカル)<a href="#howローカル-1" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなmake targetを定義しておくと<code>make check-licenses</code>で依存ライブラリに許容しないライセンスが含まれていないかを検証できる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> tool-check-licenses
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tool-check-licenses</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@if ! which cargo-deny &gt; /dev/null; <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		cargo install --locked cargo-deny; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> check-licenses
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">check-licenses</span><span style="color:#f92672">:</span> tool-check-licenses
</span></span><span style="display:flex;"><span>	cargo deny check licenses
</span></span></code></pre></div><p>許可していないライセンスのライブラリに依存していることがわかると以下のようなエラーが出力される。</p>
<p><img src="cargo-deny.webp" alt="cargo-deny.webp"></p>
<h3 id="howci-1">how(CI)<a href="#howci-1" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなyamlを定義しておくと不要な依存関係があるとCIが落ちてくれる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check licenses</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">check-licenses</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">EmbarkStudios/cargo-deny-action@v2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: <span style="color:#ae81ff">check licenses</span>
</span></span></code></pre></div><h2 id="cargo-aboutでリポジトリのライセンス表記が最新か検証する"><code>cargo-about</code>でリポジトリのライセンス表記が最新か検証する<a href="#cargo-aboutでリポジトリのライセンス表記が最新か検証する" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="why-2">why<a href="#why-2" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>冒頭でも触れた通り、多くのOSSでは依存ライブラリのライセンス表記を求めている。</p>
<p><code>fzf-make</code>では<code>CREDITS.html</code>というファイルを用意しておりそこに依存ライブラリのライセンス表記を記載している。</p>
<p>これまでは依存ライブラリを追加/削除した際に手作業でライセンス表記ファイルを更新していたが、漏れがちになっていた。</p>
<p>また、本来は依存ライブラリの依存ライブラリを再帰的にチェックしてすべてのライセンス表記をすべきなのだと思うが、手作業でそれをする気にはなれなかったので直接依存しているライブラリのライセンスしか表記できていなかった。</p>
<p>これらの課題を<code>cargo-about</code>を用いることで解決できそうだったので導入してみた。</p>
<h3 id="what-2">what<a href="#what-2" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><a href="https://github.com/EmbarkStudios/cargo-about" target="_blank" >cargo-about</a>は依存ライブラリのライセンス表記ファイルを自動生成する機能を提供する。</p>
<p>以下のようなテンプレートを用意し、<code>cargo about generate about.hbs &gt; CREDITS.html</code>を実行すると<code>CREDITS.html</code>にライセンス表記を出力してくれる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>            @<span style="color:#66d9ef">media</span> <span style="color:#f92672">(</span><span style="color:#f92672">prefers-color-scheme</span><span style="color:#f92672">:</span> <span style="color:#f92672">dark</span><span style="color:#f92672">)</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#333</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">a</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">skyblue</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">container</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">max-width</span>: <span style="color:#ae81ff">800</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">intro</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">licenses-list</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">list-style-type</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">license-used-by</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">-10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">license-text</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">max-height</span>: <span style="color:#ae81ff">200</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">overflow-y</span>: <span style="color:#66d9ef">scroll</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">white-space</span>: <span style="color:#66d9ef">pre-wrap</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">main</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;intro&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">h1</span>&gt;Third Party Licenses&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">p</span>&gt;This page lists the licenses of the projects used in fzf-make.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">h2</span>&gt;Overview of licenses:&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;licenses-overview&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                {{#each overview}}
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">li</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#{{id}}&#34;</span>&gt;{{name}}&lt;/<span style="color:#f92672">a</span>&gt; ({{count}})&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>                {{/each}}
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">h2</span>&gt;All license text:&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;licenses-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                {{#each licenses}}
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;license&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">h3</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{id}}&#34;</span>&gt;{{name}}&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">h4</span>&gt;Used by:&lt;/<span style="color:#f92672">h4</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;license-used-by&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                        {{#each used_by}}
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#f92672">li</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{#if crate.repository}} {{crate.repository}} {{else}} https://crates.io/crates/{{crate.name}} {{/if}}&#34;</span>&gt;{{crate.name}} {{crate.version}}&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>                        {{/each}}
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">pre</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;license-text&#34;</span>&gt;{{text}}&lt;/<span style="color:#f92672">pre</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>                {{/each}}
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">main</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h3 id="howローカル-2">how(ローカル)<a href="#howローカル-2" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなmake targetを定義しておくと<code>make update-license-file</code>で依存ライブラリのライセンス表記が最新か検証できる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> tool-update-license-file
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tool-update-license-file</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@if ! which cargo-about &gt; /dev/null; <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>		cargo install --locked cargo-about; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> update-license-file
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">update-license-file</span><span style="color:#f92672">:</span> tool-update-license-file
</span></span><span style="display:flex;"><span>	cargo about generate about.hbs &gt; CREDITS.html
</span></span></code></pre></div><h3 id="howci-2">how(CI)<a href="#howci-2" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>以下のようなyamlを定義しておくと依存ライブラリのライセンス表記が最新でないとCIが落ちてくれる。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check license file</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">check-license-file</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">make update-license-file</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Check diff</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          git add .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          git diff --cached --exit-code</span>          
</span></span></code></pre></div><p>なお、デフォルトだと以下の部分の<code>This page...fzf-make</code>の部分が<code>This page lists the licenses of the projects used in cargo-about.</code>として出力される。そのため、そのまま利用すると「<code>cargo-about</code>プロジェクトでは以下のライセンスに依存しています」という意味の表示になってしまうためユーザーが忘れずに<code>cargo-about</code>の部分をプロジェクト名に変更する必要があるという問題がある。<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;intro&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;Third Party Licenses&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">p</span>&gt;This page lists the licenses of the projects used in fzf-make.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span></code></pre></div><p>これに関しては以下のissueを立ててみたので<code>cargo-about</code>側と意見が一致したら修正するPRを送ってみようと思う。</p>
<p><a href="https://github.com/EmbarkStudios/cargo-about/issues/281" target="_blank" >[Feature request] change <code>cargo about init</code> to generate the statement including user&rsquo;s project name.</a></p>
<h2 id="おわりに">おわりに<a href="#おわりに" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>繰り返しの定型タスクをCIに任せることができたので開発により集中できるようになった。（趣味開発だと数ヶ月ぶりにコミットするとかもザラにあり、開発に必要なタスクを忘れがちなのでそういった意味でも自動化の範囲を増やすことができてよかった）</p>
<p>便利ツールをOSSとして公開してくれている人/企業に感謝しつつ利用するだけでなく自分にできる貢献はやっていきたい。</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><code>fzf-make</code>の紹介記事: <a href="https://zenn.dev/kyu08/articles/974fd8bc25c303" target="_blank" >[make,pnpm,yarn,justに対応]コマンドをfuzzy finder形式で選択できるCLIツール fzf-makeの紹介</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>そして実際に<a href="https://github.com/search?q=%22This&#43;page&#43;lists&#43;the&#43;licenses&#43;of&#43;the&#43;projects&#43;used&#43;in&#43;cargo-about.%22&amp;type=code" target="_blank" >90件近くのプロジェクトで<code>cargo-about</code>のままになっている。</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </div></div>

  
  

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.kyu08.com/pr-253/posts/fp-matsuri-2025/" class="button inline prev">
        関数型まつり2025に参加した
      </a>
    
    
      <a href="https://blog.kyu08.com/pr-253/posts/oblivion-keycaps/" class="button inline next">
        傾斜付きロープロファイルキーキャップNuPhy Oblivionを買った
      </a>
    
  </div>
</div>


  

  
    <script src="https://utteranc.es/client.js"
        repo="kyu08/blog-comments"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>blog.kyu08.com</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/pr-253/bundle.min.js"></script>


<font color="#808080">
  <span>
    This site uses Google Analytics for access analysis.
    Google Analytics uses cookies to collect traffic data, but this traffic data is collected anonymously and does not personally identify you.
    Cookies can be disabled in your browser.
  </span>
</font>


<script src="https://blog.kyu08.com/pr-253/blogcard.js"></script>


  
</div>

</body>
</html>
