<!DOCTYPE html>
<html lang="ja">
<head>
  
    <title>Elmで固定長配列が扱えるライブラリelm-static-arrayを触ってみた :: blog.kyu08.com</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Elmで固定長配列を扱うためのライブラリelm-static-arrayを触ってみたので感じたことを書いていきます。 elm-static-array とは elm-static-array はElmで固定長" />
<meta name="keywords" content=", " />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.kyu08.com/posts/2021121217-elm-static-array/" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-BDQ408J45J"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BDQ408J45J', { 'anonymize_ip': false });
}
</script>




  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/main.min.0832e53463742bab51a209f71625f505d20a9662c72e6fc66248658a02e0f4b9.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/menu.min.48f42ef526b5c0c074cc696ab2e25a4316fdb58c4f42be6ee88c83fed3fe3c90.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/post.min.d551b54605ea87772c5eb05bf68219699a011687df301682a1006e8811253df9.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/terminal.min.08e270ae3e1713b186bb6da1e872f4ed403127d18ae635cf9c981c6633809797.css">

  
  <link rel="stylesheet" href="https://blog.kyu08.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">




<link rel="stylesheet" href="https://blog.kyu08.com/style.css">


<link rel="shortcut icon" href="https://blog.kyu08.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.kyu08.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="kyu08_" />



<meta property="og:locale" content="ja" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Elmで固定長配列が扱えるライブラリelm-static-arrayを触ってみた">
<meta property="og:description" content="Elmで固定長配列を扱うためのライブラリelm-static-arrayを触ってみたので感じたことを書いていきます。 elm-static-array とは elm-static-array はElmで固定長" />
<meta property="og:url" content="https://blog.kyu08.com/posts/2021121217-elm-static-array/" />
<meta property="og:site_name" content="blog.kyu08.com" />

  
  
  <meta property="og:image" content="https://blog.kyu08.com/cover.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2021-12-17 01:15:48 &#43;0900 &#43;0900" />









<link rel="author" href="http://www.hatena.ne.jp/kyu08/" />




<script async src="https://www.googletagmanager.com/gtag/js?id=G-BDQ408J45J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{ . }}');
</script>




</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    blog.kyu08.com
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/tags/diary/">_misc</a></li>
        
      
        
          <li><a href="/about">about</a></li>
        
      
        
          <li><a href="/index.xml">rss</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/tags/diary/" >_misc</a></li>
        
      
        
          <li><a href="/about" >about</a></li>
        
      
        
          <li><a href="/index.xml" >rss</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.kyu08.com/posts/2021121217-elm-static-array/">Elmで固定長配列が扱えるライブラリelm-static-arrayを触ってみた</a>
  </h1>
  <div class="post-meta"><time class="post-date">2021/12/17</time>
      
    <span class="post-reading-time">6 min read (2635 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.kyu08.com/tags/elm/">Elm</a>&nbsp;
      
    </span>
  
  
  <img src="https://blog.kyu08.com/cover.png"
    class="post-cover"
    alt="Elmで固定長配列が扱えるライブラリelm-static-arrayを触ってみた"
    title="Cover Image" />


  
    <div class="table-of-contents">
      <h2>
        目次
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#elm-static-array-とは">elm-static-array とは</a></li>
    <li><a href="#どんな場面で使ったか">どんな場面で使ったか</a></li>
    <li><a href="#elm-static-array-を使うことで得られるメリット">elm-static-array を使うことで得られるメリット</a>
      <ul>
        <li><a href="#メリット仕様を型で表現しやすい">メリット①：仕様を型で表現しやすい</a></li>
        <li><a href="#メリット配列の要素を取得する際に-maybe-をハンドリングする必要がない">メリット②：配列の要素を取得する際に <code>Maybe</code> をハンドリングする必要がない</a></li>
      </ul>
    </li>
    <li><a href="#懸念点">懸念点</a>
      <ul>
        <li><a href="#懸念array-に定義されているすべての関数が定義されているわけではない">懸念①：Array に定義されているすべての関数が定義されているわけではない</a></li>
        <li><a href="#懸念staticarray-の書き方に慣れるまでは時間がかかる">懸念②：StaticArray の書き方に慣れるまでは時間がかかる</a></li>
      </ul>
    </li>
    <li><a href="#まとめ">まとめ</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <p>Elmで固定長配列を扱うためのライブラリelm-static-arrayを触ってみたので感じたことを書いていきます。</p>
<h2 id="elm-static-array-とは">elm-static-array とは<a href="#elm-static-array-とは" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><a href="https://package.elm-lang.org/packages/Orasund/elm-static-array/latest/" target="_blank" >elm-static-array</a>
 はElmで固定長配列を扱うためのライブラリです。</p>
<p>配列の長さを型で表現できることが特徴です。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#75715e">-- StaticArray</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 長さ 4 の配列</span>
</span></span><span style="display:flex;"><span>arrayLength<span style="color:#ae81ff">4</span> <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 通常の Array</span>
</span></span><span style="display:flex;"><span>ordinaryArray <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Array</span> <span style="color:#66d9ef">String</span>
</span></span></code></pre></div><h2 id="どんな場面で使ったか">どんな場面で使ったか<a href="#どんな場面で使ったか" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>趣味で開発している麻雀の点数集計アプリで使いました。</p>
<p>各プレイヤーの試合毎のスコアを記録して合計を表示するだけの簡単なアプリケーションです。(※実際には順位点やトビ賞の計算などもやっていますがここでは割愛)</p>
<p><img src="jan-log-demo.webp" alt="jan-log-demo.web"></p>
<p>ここで <strong>参加者の名前</strong> および <strong>その試合のスコア</strong> を <code>Array String</code> として扱おうとすると以下のようになります。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Players</span> <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Array</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Points</span> <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Array</span> <span style="color:#66d9ef">String</span>
</span></span></code></pre></div><p>これではあらゆる長さの配列をとることができてしまいますが、仕様上どちらも長さ4もしくは5の配列しかとることはありません。
そこでelm-static-arrayを使って配列の長さの情報を型で表現しました。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Players</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Players4</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">Player</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">|</span> <span style="color:#66d9ef">Players5</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Five</span> <span style="color:#66d9ef">Player</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Points</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Points4</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">Point</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">|</span> <span style="color:#66d9ef">Points5</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Five</span> <span style="color:#66d9ef">Point</span>)
</span></span></code></pre></div><p>ここからは実際に使ってみて感じたことを書いていきます。</p>
<h2 id="elm-static-array-を使うことで得られるメリット">elm-static-array を使うことで得られるメリット<a href="#elm-static-array-を使うことで得られるメリット" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="メリット仕様を型で表現しやすい">メリット①：仕様を型で表現しやすい<a href="#メリット仕様を型で表現しやすい" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>上でも触れましたが、長さが4もしく5の <code>Point</code> の配列はelm-static-arrayを使うと以下のように定義できます。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Points</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Points4</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">Point</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">|</span> <span style="color:#66d9ef">Points5</span> (<span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Five</span> <span style="color:#66d9ef">Point</span>)
</span></span></code></pre></div><p>elm-static-arrayを使うことで型に配列の長さの情報を持たせることができるため、<strong>仕様を型で表現しやすくなり</strong>コードの可読性向上に繋がります。</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>また、それにともなって <strong>仕様上ありえない状態が存在できないコードを書きやすくなる</strong>ため<strong>バグの可能性を減らす</strong> ことができます。</p>
<p>たとえば以下の <code>isDefaultRound</code>関数は引数に取った値がデフォルト値かどうかを判定する関数です。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">Round</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">Round4</span> <span style="color:#66d9ef">Round4Value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">|</span> <span style="color:#66d9ef">Round5</span> <span style="color:#66d9ef">Round5Value</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Round4Value</span> <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">-- 長さが 4 の StaticArray</span>
</span></span><span style="display:flex;"><span>    { points <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">Point</span>
</span></span><span style="display:flex;"><span>    , seatingOrder <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Maybe</span> <span style="color:#66d9ef">SeatingOrder</span>
</span></span><span style="display:flex;"><span>    , tobisho <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">Point</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">Round5Value</span> <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">-- 長さが 5 の StaticArray</span>
</span></span><span style="display:flex;"><span>    { points <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Five</span> <span style="color:#66d9ef">Point</span>
</span></span><span style="display:flex;"><span>    , seatingOrder <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Maybe</span> <span style="color:#66d9ef">SeatingOrder</span>
</span></span><span style="display:flex;"><span>    , tobisho <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Five</span> <span style="color:#66d9ef">Point</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>isDefaultRound <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Round</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Bool</span>
</span></span><span style="display:flex;"><span>isDefaultRound round <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> round <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Round4</span> _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            round <span style="color:#a6e22e">==</span> initRound<span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Round5</span> _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            round <span style="color:#a6e22e">==</span> initRound<span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p>仕様上 <code>Points</code> の長さは4もしくは5になるのですが、elm-static-arrayを使って書くと <code>isDefaultRound</code>関数のパターンマッチの中では仕様上ありえる値の分岐だけを扱えばいいことがわかると思います。</p>
<p>これをelm-static-arrayを使わずに書いた場合は以下のように仕様上ありえないパターンを扱う必要があります。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>isDefaultRound <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Round</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Bool</span>
</span></span><span style="display:flex;"><span>isDefaultRound round <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>length round<span style="color:#a6e22e">.</span>points <span style="color:#66d9ef">of</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">4</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            round <span style="color:#a6e22e">==</span> initRound<span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">5</span> <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            round <span style="color:#a6e22e">==</span> initRound<span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        _ <span style="color:#a6e22e">-&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">False</span>
</span></span></code></pre></div><p>elm-static-arrayを使うことで仕様上ありえないパターンを扱う必要がなくなりバグの可能性を減らすことができます。</p>
<h3 id="メリット配列の要素を取得する際に-maybe-をハンドリングする必要がない">メリット②：配列の要素を取得する際に <code>Maybe</code> をハンドリングする必要がない<a href="#メリット配列の要素を取得する際に-maybe-をハンドリングする必要がない" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>配列の要素を取得する際も通常のArrayとの違いを感じることができます。</p>
<p>以下は配列の要素を取得する <code>get</code> 関数の型定義です。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#75715e">-- 通常の配列</span>
</span></span><span style="display:flex;"><span>get <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Array</span> a <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">Maybe</span> a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- StaticArray</span>
</span></span><span style="display:flex;"><span>get <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Index</span> n <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">StaticArray</span> n a <span style="color:#a6e22e">-&gt;</span> a
</span></span></code></pre></div><p>注目すべきは <strong>返り値の型</strong> です。</p>
<p>通常の配列では要素の型が <code>a</code> である配列の要素を取得する際の返り値の型が <code>Maybe a</code> になりますが、 elm-static-arrayでは返り値の型が <code>a</code> になります。
これにより <strong><code>Maybe</code> をハンドリングする必要がなくなるためよりシンプルに記述できます。</strong></p>
<h2 id="懸念点">懸念点<a href="#懸念点" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>逆に懸念だと感じたのは以下の2つです。</p>
<ul>
<li>Arrayに定義されているすべての関数が定義されているわけではない</li>
<li>elm-static-arrayの書き方に慣れるまでは時間がかかる</li>
</ul>
<p>それぞれ補足していきます。</p>
<h3 id="懸念array-に定義されているすべての関数が定義されているわけではない">懸念①：Array に定義されているすべての関数が定義されているわけではない<a href="#懸念array-に定義されているすべての関数が定義されているわけではない" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Arrayに生えている関数がStaticArrayには生えてなかったりするので、都度Arrayに変換して処理をした上で再度StaticArrayに変換する、というような工程が必要になる場面がありました。StaticArrayには最小限の関数しか定義されていないので例えば <code>filter</code> や <code>foldl(foldr)</code> などは一度Arrayなどに変換し、処理してから再度StaticArrayに変換しなおす必要がありました。</p>
<p>以下はStaticArrayをArrayに変換してfilterしてStaticArrayに戻すコード例です。</p>
<p><code>StaticArray.fromList</code> がheadとtailを引数に取るため若干コード量が増えてしまいます。</p>
<p>headの要素を取り出す際にNothingをハンドリングしなければならないのがちょっと億劫ですね。(もちろんコンパイラはStaticArrayから変換されたArrayであることなど知るよしもないので仕方ないのですが)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>filterStaticArray <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">String</span> <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">StaticArray</span> <span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span><span style="color:#66d9ef">Four</span> <span style="color:#66d9ef">String</span>
</span></span><span style="display:flex;"><span>filterStaticArray staticArray <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>        filteredArray <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            staticArray
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">StaticArray</span><span style="color:#a6e22e">.</span>toArray
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>filter (<span style="color:#a6e22e">(/=)</span> <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        head <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Maybe</span><span style="color:#a6e22e">.</span>withDefault <span style="color:#e6db74">&#34;undefined&#34;</span> <span style="color:#a6e22e">&lt;|</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>get
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                    filteredArray
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        tail <span style="color:#a6e22e">=</span>
</span></span><span style="display:flex;"><span>            filteredArray
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>slice <span style="color:#ae81ff">1</span> (<span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>length filteredArray)
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">|&gt;</span> <span style="color:#66d9ef">Array</span><span style="color:#a6e22e">.</span>toList
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">StaticArray</span><span style="color:#a6e22e">.</span>fromList
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Length</span><span style="color:#a6e22e">.</span>four
</span></span><span style="display:flex;"><span>        head
</span></span><span style="display:flex;"><span>        tail
</span></span></code></pre></div><h3 id="懸念staticarray-の書き方に慣れるまでは時間がかかる">懸念②：StaticArray の書き方に慣れるまでは時間がかかる<a href="#懸念staticarray-の書き方に慣れるまでは時間がかかる" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>たとえばインデックスを指定してStaticArrayの要素を取得するget関数を使おうと<a href="https://package.elm-lang.org/packages/Orasund/elm-static-array/latest/StaticArray#get" target="_blank" >ドキュメント</a>
を見ると、下記のような記述があります。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span><span style="color:#75715e">-- Gets an element of the array. Note that it only possible if the index is in bound. Therefore eliminating Off-by-one errors.</span>
</span></span><span style="display:flex;"><span>get <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Index</span> n <span style="color:#a6e22e">-&gt;</span> <span style="color:#66d9ef">StaticArray</span> n a <span style="color:#a6e22e">-&gt;</span> a
</span></span></code></pre></div><p>自分のElm力の乏しさのせいではありますがドキュメントに具体的なコード例が示されていないこともあり、動かすまでにそれなりの試行錯誤が必要でした。(当時はGitHubで検索しても引っ掛からずに絶望していましたが、検索の仕方が悪かっただけだということに執筆時に気付きました。)
実際には以下のような使い方をする必要があります。ちゃんと動くコードを書くのに1hくらい費やしてしまいました。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elm" data-lang="elm"><span style="display:flex;"><span>head <span style="color:#a6e22e">:</span> <span style="color:#66d9ef">Element</span>
</span></span><span style="display:flex;"><span>head <span style="color:#a6e22e">=</span> <span style="color:#66d9ef">StaticArray</span><span style="color:#a6e22e">.</span>get (<span style="color:#66d9ef">Index</span><span style="color:#a6e22e">.</span>fromModBy <span style="color:#66d9ef">Length</span><span style="color:#a6e22e">.</span>four <span style="color:#ae81ff">0</span>) someStaticArray
</span></span></code></pre></div><p>まとめると、 <strong>多少の手間が必要になる</strong> ということかなと思います。
このあたりがelm-static-arrayの作者が <a href="https://package.elm-lang.org/packages/Orasund/elm-static-array/latest/" target="_blank" >README</a>
 の中で以下のように言っている所以かなと感じました。</p>
<blockquote>
<p>Construction is a bit slower (should be neglectable for most cases).</p>
</blockquote>
<p>ただ逆に言えばネガティブに感じたのは上記のそれくらいで、基本的にはメリットの方が大きく感じたためこれからも必要であれば使っていきたいと思っています。</p>
<h2 id="まとめ">まとめ<a href="#まとめ" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Elmで固定長配列を扱うためのライブラリelm-static-arrayを触った感想を書いてみました。</p>
<p>仕様を型で表現しやすくなるという点に魅力を感じたので今後も必要なケースでは積極的に使っていきたいと思います。</p>
<p>また、ひさびさに個人開発をして、なかなか時間が取れずコードの意図や全体像をよく忘れたりするので個人開発においても可読性が高かったり意図の伝わりやすいコードを書くことの重要性が身に染みました。</p>
<p>時間がなかなかとれないからこそ質の高いコードを意識的に書いていきたいなと思います。</p>

      </div></div>

  
  

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.kyu08.com/posts/consultant/" class="button inline prev">
        『コンサル一年目が学ぶこと』を読んだ
      </a>
    
    
      ::
    
    
      <a href="https://blog.kyu08.com/posts/20211203-introduce/" class="button inline next">
        自己紹介
      </a>
    
  </div>
</div>


  

  
    <script src="https://utteranc.es/client.js"
        repo="kyu08/blog-comments"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>blog.kyu08.com</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>


<font color="#808080">
  <span>
    This site uses Google Analytics for access analysis.
    Google Analytics uses cookies to collect traffic data, but this traffic data is collected anonymously and does not personally identify you.
    Cookies can be disabled in your browser.
  </span>
</font>


  
</div>

</body>
</html>
